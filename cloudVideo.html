<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galeri Karya Siswa & Badge Penghargaan</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: 'üé¨';
            position: absolute;
            top: 20px;
            left: 30px;
            font-size: 4em;
            opacity: 0.2;
            animation: float 3s ease-in-out infinite;
        }

        .header::after {
            content: 'üèÜ';
            position: absolute;
            bottom: 20px;
            right: 30px;
            font-size: 4em;
            opacity: 0.2;
            animation: float 3s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .header h1 {
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.8em;
            margin-bottom: 15px;
        }

        .header p {
            color: #666;
            font-size: 1.3em;
            margin-bottom: 20px;
        }

        .skills-banner {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .skill-badge {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            padding: 12px 25px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1em;
            box-shadow: 0 5px 15px rgba(240, 147, 251, 0.4);
        }

        .mindset-section {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            border-left: 6px solid #ff6b6b;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .mindset-section h2 {
            color: #d63031;
            margin-bottom: 15px;
            font-size: 1.8em;
        }

        .mindset-section p {
            color: #2d3436;
            line-height: 1.9;
            font-size: 1.15em;
        }

        .setup-guide {
            background: #fff3cd;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }

        .setup-guide h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .setup-guide ol {
            color: #333;
            line-height: 1.8;
            padding-left: 20px;
            margin-top: 10px;
        }

        .setup-guide code {
            background: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            color: #d63031;
            font-family: monospace;
            font-size: 0.9em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .upload-section, .badge-section {
            background: white;
            padding: 35px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .section-title {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .story-display {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-left: 5px solid #667eea;
        }

        .story-display h3 {
            color: #764ba2;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .story-display p {
            color: #2d3436;
            line-height: 1.9;
            margin-bottom: 12px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1em;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .file-upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload-area:hover {
            background: #e8ebff;
            border-color: #764ba2;
        }

        .file-upload-area.dragover {
            background: #e8ebff;
            border-color: #764ba2;
            transform: scale(1.02);
        }

        .file-upload-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .file-info {
            margin-top: 15px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 10px;
            color: #1976d2;
            font-size: 0.95em;
            text-align: left;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 16px 40px;
            border: none;
            border-radius: 12px;
            font-size: 1.15em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 15px;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            width: 0%;
        }

        .my-badges {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .badge-item {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            transition: all 0.3s;
            position: relative;
            border: 3px solid transparent;
        }

        .badge-item.earned {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-color: #ff9800;
            animation: pulse 2s infinite;
        }

        .badge-item.locked {
            opacity: 0.5;
            filter: grayscale(100%);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .badge-icon {
            font-size: 4em;
            margin-bottom: 10px;
        }

        .badge-name {
            color: #333;
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.95em;
        }

        .badge-desc {
            color: #666;
            font-size: 0.85em;
        }

        .badge-earned-mark {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4caf50;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .stats-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .stat-item {
            flex: 1;
            min-width: 150px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.95em;
            opacity: 0.9;
        }

        .gallery-section {
            background: white;
            padding: 35px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .filter-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 1em;
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }

        .works-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
        }

        .work-card {
            background: #f8f9fa;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
            cursor: pointer;
        }

        .work-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.2);
        }

        .work-thumbnail {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .work-thumbnail img, .work-thumbnail video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .work-thumbnail .play-icon {
            position: absolute;
            font-size: 3em;
            background: rgba(0,0,0,0.6);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .work-info {
            padding: 20px;
        }

        .work-title {
            color: #333;
            font-weight: 600;
            font-size: 1.2em;
            margin-bottom: 8px;
        }

        .work-author {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .work-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
            font-size: 0.95em;
        }

        .work-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
            color: #999;
        }

        .work-type {
            background: #e3f2fd;
            color: #1976d2;
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2em;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
            grid-column: 1 / -1;
        }

        .empty-state-icon {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 2.5em;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
            line-height: 1;
        }

        .close-modal:hover {
            color: #667eea;
        }

        .media-preview {
            margin: 20px 0;
            border-radius: 12px;
            overflow: hidden;
            background: #000;
        }

        .media-preview video, .media-preview audio {
            width: 100%;
            max-height: 500px;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2em;
            }

            .works-grid {
                grid-template-columns: 1fr;
            }

            .my-badges {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ Galeri Karya Siswa & Badge Penghargaan</h1>
            <p>Bagikan karyamu dan raih badge kehormatan!</p>
            <div class="skills-banner">
                <span class="skill-badge">üåç Citizenship</span>
                <span class="skill-badge">‚≠ê Character</span>
                <span class="skill-badge">üí¨ Communication</span>
            </div>
        </div>

        <div class="mindset-section">
            <h2>üå± Growth Mindset: Keberanian Menunjukkan Karya</h2>
            <p>
                <strong>Setiap karya adalah bentuk keberanian!</strong> Menunjukkan hasil kerja kita membutuhkan keberanian yang luar biasa. 
                Tidak masalah jika belum sempurna - yang penting adalah proses belajar dan keberanian untuk berbagi. 
                Setiap presentasi, setiap video, setiap rekaman adalah langkah menuju versi terbaik dirimu. 
                Mari kita apresiasi keberanian setiap siswa yang tampil! üëè‚ú®
            </p>
        </div>

        <div class="setup-guide" style="display:none">
            <h4>‚öôÔ∏è Setup Firebase & Cloudinary:</h4>
            <ol>
                <li><strong>Firebase:</strong> Buat project ‚Üí Realtime Database ‚Üí Copy config</li>
                <li><strong>Cloudinary:</strong> Cloud Name: <code>dfkw4uxOe</code> (sudah ada) ‚Üí Buat Upload Preset</li>
                <li>Paste kredensial di JavaScript (baris 620-630)</li>
            </ol>
        </div>

        <div class="main-content">
            <div class="upload-section">
                <h2 class="section-title">üì§ Unggah Karyamu</h2>
                
                <div id="alertBox"></div>

                <div class="story-display">
                    <h3>üìñ Cerita: Cuci Tanganku Bersih</h3>
                    <p>Pagi ini, matahari bersinar cerah. Siti bermain di halaman rumah. Tiba-tiba, ibu memanggil, "Sinta, ayo makan!" Sinta berlari ke dapur.</p>
                    <p>Ibu berkata, "Cuci tangan dulu, ya." Sinta pergi ke wastafel. Air mengalir. Sinta membasahi tangannya. Ia mengambil sabun. Buih sabun putih keluar.</p>
                    <p>Sinta menggosok telapak tangan. Ia menggosok punggung tangan. Ia menggosok sela-sela jari. Air membilas tangan Sinta. Tangan Sinta bersih dan wangi.</p>
                    <p>Ibu tersenyum, "Bagus sekali, Sinta!" Sinta pun makan dengan gembira.</p>
                </div>

                <div class="form-group">
                    <label for="studentName">Nama Siswa: *</label>
                    <input type="text" id="studentName" placeholder="Masukkan namamu...">
                </div>

                <div class="form-group">
                    <label for="workTitle">Judul Karya: *</label>
                    <input type="text" id="workTitle" placeholder="Beri judul karyamu...">
                </div>

                <div class="form-group">
                    <label for="workType">Jenis Karya: *</label>
                    <select id="workType">
                        <option value="">-- Pilih Jenis --</option>
                        <option value="video">üé• Video Pendek</option>
                        <option value="audio">üéôÔ∏è Audio/Pembacaan Cerita</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="workDescription">Deskripsi Karya: *</label>
                    <textarea id="workDescription" placeholder="Ceritakan tentang karyamu..."></textarea>
                </div>

                <div class="form-group">
                    <label>Unggah File (Video/Audio): *</label>
                    <div class="file-upload-area" id="fileUploadArea">
                        <div class="file-upload-icon">üìÅ</div>
                        <p><strong>Klik untuk pilih file</strong> atau drag & drop</p>
                        <p style="color: #999; font-size: 0.9em; margin-top: 10px;">
                            Video: MP4, WebM, MOV (max 100MB)<br>
                            Audio: MP3, WAV, M4A (max 50MB)
                        </p>
                    </div>
                    <input type="file" id="fileInput" accept="video/*,audio/*" style="display: none;">
                    <div id="fileInfo" class="file-info" style="display: none;"></div>
                    <div class="progress-bar" id="progressBar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <button class="btn" id="uploadBtn">üöÄ Unggah Karya</button>
            </div>

            <div class="badge-section">
                <h2 class="section-title">üèÜ Badge Penghargaanmu</h2>
                
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-number" id="badgeCount">0</div>
                        <div class="stat-label">Badge Diraih</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="workCount">0</div>
                        <div class="stat-label">Karya Diunggah</div>
                    </div>
                </div>

                <div class="my-badges" id="badgeList"></div>

                <div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 12px; border-left: 4px solid #4caf50;">
                    <strong style="color: #2e7d32;">üí° Cara Mendapatkan Badge:</strong>
                    <ul style="margin-top: 10px; color: #333; line-height: 1.8; padding-left: 20px;">
                        <li>üåü Karya Pertama - Unggah karya pertamamu</li>
                        <li>‚ú® Percikan Kreatif - Unggah 3 karya</li>
                        <li>üé¨ Bintang Video - Buat video pendek</li>
                        <li>üéôÔ∏è Suara Emas - Rekam pembacaan cerita</li>
                        <li>üí™ Hati Pemberani - Tampil dengan berani</li>
                        <li>üåà Inspirasi - Unggah 5 karya</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="gallery-section">
            <h2 class="section-title">üé® Galeri Karya Semua Siswa</h2>
            <p style="color: #666; margin-bottom: 20px;">Mari kita apresiasi keberanian dan kreativitas teman-teman kita!</p>
            
            <div class="filter-bar">
                <button class="filter-btn active" data-filter="all">üìö Semua</button>
                <button class="filter-btn" data-filter="video">üé• Video</button>
                <button class="filter-btn" data-filter="audio">üéôÔ∏è Audio</button>
            </div>

            <div id="worksGallery" class="works-grid">
                <div class="loading">‚è≥ Memuat karya siswa...</div>
            </div>
        </div>
    </div>

    <div id="workModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
        import { getDatabase, ref, push, onValue, set } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";
        

// === Konfigurasi Firebase ===
const firebaseConfig = {
    apiKey: "AIzaSyAjq2oHpqcS3SjYTPUyTBMg0sByPrSTeHk",
    authDomain: "unggahan-video.firebaseapp.com",
    databaseURL: "https://unggahan-video-default-rtdb.asia-southeast1.firebasedatabase.app/",
    projectId: "unggahan-video",
    storageBucket: "unggahan-video.firebasestorage.app",
    messagingSenderId: "678913480805",
    appId: "1:678913480805:web:b70bb8d9e3450d5f104e8c",
    measurementId: "G-RSQBHD5H4P"
};

// === Inisialisasi Firebase ===
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);



// === Konfigurasi Cloudinary ===
const CLOUDINARY_CLOUD_NAME = "dfkw4ux0e";
const CLOUDINARY_UPLOAD_PRESET = "kumpulan";

// === Elemen HTML ===
const uploadBtn = document.getElementById("uploadBtn");
const fileInput = document.getElementById("fileInput");
const fileUploadArea = document.getElementById("fileUploadArea");
const fileInfo = document.getElementById("fileInfo");
const progressBar = document.getElementById("progressBar");
const progressFill = document.getElementById("progressFill");
const worksGallery = document.getElementById("worksGallery");
const badgeCount = document.getElementById("badgeCount");
const workCount = document.getElementById("workCount");
const badgeList = document.getElementById("badgeList");
const alertBox = document.getElementById("alertBox");

let selectedFile = null;

// === Badge Rules ===
const badges = [
    { id: "first_work", icon: "üåü", name: "Karya Pertama", desc: "Unggah karya pertama", requirement: 1 },
    { id: "creative_spark", icon: "‚ú®", name: "Percikan Kreatif", desc: "Unggah 3 karya", requirement: 3 },
    { id: "video_star", icon: "üé¨", name: "Bintang Video", desc: "Unggah video", type: "video" },
    { id: "audio_gold", icon: "üéôÔ∏è", name: "Suara Emas", desc: "Unggah audio", type: "audio" },
    { id: "brave_heart", icon: "üí™", name: "Hati Pemberani", desc: "Berani tampil", requirement: 2 },
    { id: "inspiration", icon: "üåà", name: "Inspirasi", desc: "Unggah 5 karya", requirement: 5 }
];

// === Fungsi tampilkan alert ===
function showAlert(type, message) {
    alertBox.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
    setTimeout(() => alertBox.innerHTML = "", 4000);
}

// === Drag & Drop ===
fileUploadArea.addEventListener("click", () => fileInput.click());
fileUploadArea.addEventListener("dragover", (e) => {
    e.preventDefault();
    fileUploadArea.classList.add("dragover");
});
fileUploadArea.addEventListener("dragleave", () => fileUploadArea.classList.remove("dragover"));
fileUploadArea.addEventListener("drop", (e) => {
    e.preventDefault();
    fileUploadArea.classList.remove("dragover");
    fileInput.files = e.dataTransfer.files;
    showFileInfo(fileInput.files[0]);
});
fileInput.addEventListener("change", (e) => {
    selectedFile = e.target.files[0];
    if (selectedFile) {
        fileInfo.style.display = "block";
        fileInfo.innerHTML = `<strong>File:</strong> ${selectedFile.name} (${(selectedFile.size / 1024 / 1024).toFixed(2)} MB)`;
    }
});

function showFileInfo(file) {
    fileInfo.style.display = "block";
    fileInfo.textContent = `File: ${file.name} (${(file.size/1024/1024).toFixed(2)} MB)`;
}

// === Upload ke Cloudinary ===
async function uploadToCloudinary(file) {
    const url = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/auto/upload`;
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", CLOUDINARY_UPLOAD_PRESET);
    
    progressBar.style.display = "block";
    progressFill.style.width = "0%";

    const response = await fetch(url, {
        method: "POST",
        body: formData
    });

    const data = await response.json();
    progressFill.style.width = "100%";
    return data.secure_url;
}

// === Simpan data ke Firebase ===
async function saveWork(data) {
    const worksRef = ref(db, "works");
    await push(worksRef, data);
}

// === Tampilkan Galeri ===
function renderGallery(works) {
    worksGallery.innerHTML = "";
    if (!works || Object.keys(works).length === 0) {
        worksGallery.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üì≠</div>Tidak ada karya siswa</div>`;
        return;
    }

    Object.values(works).forEach((work) => {
        const card = document.createElement("div");
        card.classList.add("work-card");
        card.innerHTML = `
            <div class="work-thumbnail">
                ${work.type === "video" ? `<video src="${work.url}" controls></video>` : `<audio controls src="${work.url}"></audio>`}
            </div>
            <div class="work-info">
                <div class="work-title">${work.title}</div>
                <div class="work-author">${work.name}</div>
                <div class="work-description">${work.description}</div>
                <div class="work-meta"><span class="work-type">${work.type}</span></div>
                <div class="work-meta"><a href="${work.url}">Lihat</a></div>
            </div>
        `;
        worksGallery.appendChild(card);
    });
}

// === Update Badge ===
function updateBadges(works) {
    const total = Object.keys(works).length;
    workCount.textContent = total;
    badgeList.innerHTML = "";
    let earned = [];

    badges.forEach((badge) => {
        let unlocked = false;
        if (badge.requirement && total >= badge.requirement) unlocked = true;
        if (badge.type && Object.values(works).some(w => w.type === badge.type)) unlocked = true;

        const div = document.createElement("div");
        div.classList.add("badge-item");
        if (unlocked) div.classList.add("earned");
        div.innerHTML = `
            <div class="badge-icon">${badge.icon}</div>
            <div class="badge-name">${badge.name}</div>
            <div class="badge-desc">${badge.desc}</div>
            ${unlocked ? `<div class="badge-earned-mark">‚úî</div>` : ""}
        `;
        badgeList.appendChild(div);
        if (unlocked) earned.push(badge);
    });
    badgeCount.textContent = earned.length;
}

// === Ambil data dari Firebase ===
onValue(ref(db, "works"), (snapshot) => {
    const data = snapshot.val() || {};
    renderGallery(data);
    updateBadges(data);
});

// === Upload Button Click ===
uploadBtn.addEventListener("click", async () => {
    if (!selectedFile) return showAlert("error", "Pilih file terlebih dahulu!");
  const studentName = document.getElementById("studentName").value.trim();
  const workTitle = document.getElementById("workTitle").value.trim();
  const workType = document.getElementById("workType").value.trim();
  const workDescription = document.getElementById("workDescription").value.trim();

  if (!studentName || !workTitle || !workType || !workDescription) {
    return showAlert("error", "Lengkapi semua field sebelum mengunggah!");
  }

  // Siapkan form data
  const formData = new FormData();
  formData.append("file", selectedFile);
  formData.append("upload_preset", CLOUDINARY_UPLOAD_PRESET);

  const resourceType = workType === "video" ? "video" : "auto";
  const cloudinaryURL = `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/${resourceType}/upload`;

  uploadBtn.disabled = true;
  progressBar.style.display = "block";
  progressFill.style.width = "0%";

  try {
    const xhr = new XMLHttpRequest();
    xhr.open("POST", cloudinaryURL);

    // progress bar update
    xhr.upload.addEventListener("progress", (e) => {
      if (e.lengthComputable) {
        const percent = (e.loaded / e.total) * 100;
        progressFill.style.width = `${percent.toFixed(0)}%`;
      }
    });

    xhr.onload = async () => {
      if (xhr.status === 200) {
        const response = JSON.parse(xhr.responseText);
        const fileUrl = response.secure_url;
        showAlert("success", "‚úÖ Berhasil diunggah ke Cloudinary!");

        // Simpan metadata ke Firebase
        const worksRef = ref(db, "works");
        await push(worksRef, {
          name: studentName,
          title: workTitle,
          type: workType,
          description: workDescription,
          fileUrl: fileUrl,
          timestamp: Date.now(),
        });

        showAlert("success", "üî• Karya berhasil disimpan ke Firebase!");
      } else {
        showAlert("error", "‚ùå Gagal mengunggah ke Cloudinary.");
      }
      uploadBtn.disabled = false;
    };

    xhr.onerror = () => {
      showAlert("error", "‚ö†Ô∏è Terjadi kesalahan koneksi.");
      uploadBtn.disabled = false;
    };

    xhr.send(formData);

  } catch (error) {
    console.error(error);
    showAlert("error", "‚ùå Upload error: " + error.message);
    uploadBtn.disabled = false;
  }
});
    </script>

    <!--
    ===== PANDUAN SETUP LENGKAP =====

    1. FIREBASE REALTIME DATABASE:
       a. Buka https://console.firebase.google.com
       b. Buat project baru atau pilih existing
       c. Build ‚Üí Realtime Database ‚Üí Create Database
       d. Pilih location (asia-southeast1 untuk Indonesia)
       e. Start in TEST MODE
       f. Rules ‚Üí Edit:
          {
            "rules": {
              ".read": true,
              ".write": true
            }
          }
       g. Project Settings ‚Üí Copy Firebase Config
       h. Paste ke baris 620-627 di HTML ini

    2. CLOUDINARY SETUP:
       a. Login ke https://cloudinary.com
       b. Cloud Name sudah ada: dfkw4uxOe
       c. Settings ‚Üí Upload ‚Üí Add upload preset
       d. Settings preset:
          - Signing Mode: Unsigned
          - Preset name: student_uploads (atau nama lain)
          - Folder: student-works (opsional)
       e. Save
       f. Copy preset name
       g. Paste ke baris 630 (CLOUDINARY_UPLOAD_PRESET)

    3. STRUKTUR DATA FIREBASE:
       works/
         ‚îú‚îÄ -NxAbC123/
         ‚îÇ   ‚îú‚îÄ studentName: "Andi"
         ‚îÇ   ‚îú‚îÄ workTitle: "Video Sinta"
         ‚îÇ   ‚îú‚îÄ workType: "video"
         ‚îÇ   ‚îú‚îÄ workDescription: "..."
         ‚îÇ   ‚îú‚îÄ fileName: "video.mp4"
         ‚îÇ   ‚îú‚îÄ fileUrl: "https://res.cloudinary.com/..."
         ‚îÇ   ‚îú‚îÄ thumbnailUrl: "https://..."
         ‚îÇ   ‚îî‚îÄ timestamp: 1234567890
         ‚îî‚îÄ -NxAbC124/
             ‚îî‚îÄ ...

    4. FITUR APLIKASI:
       ‚úÖ Upload video/audio ke Cloudinary
       ‚úÖ Simpan metadata ke Firebase Realtime Database
       ‚úÖ Real-time sync antar user
       ‚úÖ Badge system dengan localStorage
       ‚úÖ Video/audio player preview
       ‚úÖ Filter karya (Semua/Video/Audio)
       ‚úÖ Drag & drop upload
       ‚úÖ Progress bar upload
       ‚úÖ Responsive design
       ‚úÖ Growth mindset messaging

    5. TESTING:
       - Buka HTML di browser
       - Isi form dan upload file test
       - File akan ke Cloudinary, data ke Firebase
       - Buka di tab/browser lain untuk test real-time sync
       - Badge otomatis diberikan saat mencapai milestone

    CATATAN PENTING:
    - Firebase Test Mode hanya untuk development (ubah rules untuk production)
    - Cloudinary gratis: 25 credits/month (~500 uploads)
    - Firebase gratis: 1GB storage, 10GB transfer/month
    - Data badge tersimpan di localStorage per browser
    -->
</body>
</html>